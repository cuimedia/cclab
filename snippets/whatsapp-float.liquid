{%- comment -%}
  WhatsApp Floating Button â€” App Embed Snippet
{%- endcomment -%}

{%- assign s = settings -%}
{%- assign page_type = request.page_type -%}

/* page targeting */
{%- assign show = false -%}
{%- if s.show_everywhere -%}
  {%- assign show = true -%}
{%- else -%}
  {%- if page_type == 'index' and s.show_on_home -%}{%- assign show = true -%}{%- endif -%}
  {%- if page_type == 'product' and s.show_on_product -%}{%- assign show = true -%}{%- endif -%}
  {%- if page_type == 'collection' and s.show_on_collection -%}{%- assign show = true -%}{%- endif -%}
  {%- if page_type == 'article' and s.show_on_article -%}{%- assign show = true -%}{%- endif -%}
  {%- if page_type == 'cart' and s.show_on_cart -%}{%- assign show = true -%}{%- endif -%}
{%- endif -%}

{%- assign raw_number = s.whatsapp_number | default: '' -%}
{%- assign number = raw_number
  | replace: '+',''
  | replace: ' ',''
  | replace: '-',''
  | replace: '(','' | replace: ')',''
-%}

{%- if show and number != '' -%}
  <link rel="stylesheet" href="{{ 'whatsapp-float.css' | asset_url }}">

  {%- capture default_text -%}Hello {{ shop.name }}, I need some help with my order.{%- endcapture -%}

  <div id="wa-float-root"
       data-number="{{ number }}"
       data-message="{{ s.prefill_message | default: default_text | escape }}"
       data-position="{{ s.position }}"
       data-offset-x="{{ s.offset_x }}"
       data-offset-y="{{ s.offset_y }}"
       data-size="{{ s.size }}"
       data-bg="{{ s.bg_color }}"
       data-icon="{{ s.icon_color }}"
       data-mobile="{{ s.show_on_mobile }}"
       data-desktop="{{ s.show_on_desktop }}"
       data-open-in-new="{{ s.open_in_new }}"
       aria-hidden="true"></div>

  <script src="{{ 'whatsapp-float.js' | asset_url }}" defer></script>
{%- endif -%}

{% schema %}
{
  "name": "WhatsApp Floating Button",
  "target": "body",
  "enabled_on": { "templates": ["*"] },
  "settings": [
    { "type": "text", "id": "whatsapp_number", "label": "WhatsApp number (E.164 without +)", "info": "Example: 447912345678 for UK", "default": "" },
    { "type": "textarea", "id": "prefill_message", "label": "Prefilled message", "default": "Hello {{ shop.name }}, I need some help with my order." },

    { "type": "select", "id": "position", "label": "Button position", "default": "right",
      "options": [ { "value": "right", "label": "Bottom right" }, { "value": "left", "label": "Bottom left" } ] },

    { "type": "range", "id": "offset_x", "label": "Horizontal offset (px)", "default": 24, "min": 0, "max": 80, "step": 1 },
    { "type": "range", "id": "offset_y", "label": "Vertical offset (px)", "default": 24, "min": 0, "max": 120, "step": 1 },

    { "type": "select", "id": "size", "label": "Button size", "default": "56",
      "options": [ { "value": "48", "label": "Small" }, { "value": "56", "label": "Medium" }, { "value": "64", "label": "Large" } ] },

    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#25D366" },
    { "type": "color", "id": "icon_color", "label": "Icon color", "default": "#FFFFFF" },

    { "type": "checkbox", "id": "open_in_new", "label": "Open in new tab", "default": true },

    { "type": "header", "content": "Visibility" },
    { "type": "checkbox", "id": "show_everywhere", "label": "Show on all pages", "default": true },
    { "type": "checkbox", "id": "show_on_home", "label": "Home page", "default": true },
    { "type": "checkbox", "id": "show_on_product", "label": "Product pages", "default": true },
    { "type": "checkbox", "id": "show_on_collection", "label": "Collection pages", "default": true },
    { "type": "checkbox", "id": "show_on_article", "label": "Blog articles", "default": false },
    { "type": "checkbox", "id": "show_on_cart", "label": "Cart page", "default": true },

    { "type": "header", "content": "Devices" },
    { "type": "checkbox", "id": "show_on_mobile", "label": "Show on mobile", "default": true },
    { "type": "checkbox", "id": "show_on_desktop", "label": "Show on desktop", "default": true }
  ]
}
{% endschema %}
